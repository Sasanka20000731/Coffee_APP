<div class="container py-4">
  <div class="card mx-auto" style="max-width:720px;">
    <div class="card-header bg-primary text-white">
      <h5 class="mb-0">Create Order</h5>
    </div>
    <div class="card-body">
      <form [formGroup]="orderForm" (ngSubmit)="onSubmit()" novalidate>

        <div class="mb-3">
          <label class="form-label required">Product Category</label>
          <select class="form-select" formControlName="OrderProductCategory">
            <option value="" disabled selected>Select category</option>
            <option *ngFor="let c of productCategories" [value]="c.id">{{ c.name }}</option>
          </select>
          <div class="text-danger small" *ngIf="orderForm.get('OrderProductCategory')?.touched && orderForm.get('OrderProductCategory')?.invalid">
            Category is required.
          </div>
        </div>

        <div class="mb-3">
          <label class="form-label required">Quantity</label>
          <input type="number" class="form-control" formControlName="Quantity" min="1">
          <div class="text-danger small" *ngIf="orderForm.get('Quantity')?.touched && orderForm.get('Quantity')?.invalid">
            Enter a valid quantity (min 1).
          </div>
        </div>

        <div class="mb-3">
          <label class="form-label">Special Name</label>
          <input type="text" class="form-control" formControlName="SpecialName" maxlength="100">
        </div>

        <div class="mb-3">
          <label class="form-label">Special Description</label>
          <textarea class="form-control" rows="3" formControlName="SpecialDescription"></textarea>
        </div>

        <div class="mb-3">
          <label class="form-label">Extras</label>
          <div class="list-group">
            <div *ngFor="let extra of availableExtras" class="list-group-item d-flex justify-content-between align-items-center">
              <span>{{ extra.ItemName }}</span>
              <button type="button" class="btn btn-sm btn-outline-primary" (click)="addExtra(extra)" [disabled]="isExtraSelected(extra)">
                Add
              </button>
            </div>
          </div>

          <div *ngIf="extraItems.length" class="mt-2">
            <h6 class="small mb-1">Selected Extras</h6>
            <ul class="list-group">
              <li class="list-group-item d-flex justify-content-between align-items-center p-2" *ngFor="let e of extraItems.controls; let i = index">
                <span class="small">{{ e.value.ItemName }}</span>
                <button type="button" class="btn btn-sm btn-outline-danger" (click)="removeExtraAt(i)">Remove</button>
              </li>
            </ul>
          </div>
        </div>

        <div class="d-flex justify-content-end gap-2">
          <button type="reset" class="btn btn-secondary" [disabled]="isSubmitting">Reset</button>
          <button type="submit" class="btn btn-primary" [disabled]="orderForm.invalid || isSubmitting">
            <span *ngIf="isSubmitting" class="spinner-border spinner-border-sm me-1"></span>
            {{ isSubmitting ? 'Saving...' : 'Submit Order' }}
          </button>
        </div>

      </form>
    </div>
  </div>

  <div class="card mt-3" *ngIf="showDebug">
    <div class="card-header"><strong>Debug</strong></div>
    <div class="card-body">
      <pre>{{ getFormValue() | json }}</pre>
      <pre>Payload: {{ buildPayload() | json }}</pre>
    </div>
  </div>
</div>
